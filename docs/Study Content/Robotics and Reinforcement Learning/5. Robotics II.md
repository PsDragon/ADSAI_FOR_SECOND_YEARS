# Robotic Control

Robotic control is the process of controlling a robot. The control system is the part of a robot that is responsible for the robot's behavior. This includes the physical movement of the robot, as well as the logical decisions that the robot makes. The control algorithm receives sensor data from the robot's sensors, and then uses this data to make decisions about how to move the robot. It is usually a computer program that is loaded onto the robot's microcontroller. The control system is usually written in a high-level programming language, such as C or C++ or python, and then compiled into machine code that can be executed by the microcontroller.

In this module we will learn about different types of robotic control algorithms, and how to implement them in python.

After this module, you will be able to:

- [ ] Understand the basic concepts of robotic control
- [ ] Understand the basic concepts of PID control
- [ ] Implement a PID controller in python

## Error Signals

In order to control a robot, we need to know how far away it is from its goal. This is called the error signal. The error signal is the difference between the current state of the robot and the desired state of the robot. For example, if the robot is 10 cm away from its goal, then the error signal is 10 cm. Error signals are the difference between the desired output and the actual output. The error signal is used to determine how to change the input to the system to reduce the error. The error signal is usually a number, but it can also be a vector. 

## Bang Bang Control

Bang bang control is a simple control algorithm that is used to control a system that has two possible states. For example, a robot that has a motor that can be turned on or off. The control algorithm turns the motor on when the error signal is positive, and turns the motor off when the error signal is negative. This is called bang bang control because the motor is either on or off, there is no in-between state.

## Proportional Control

Proportional control is a control algorithm that is used to control a system that has a continuous range of possible states. For example, a robot that has a motor that can be turned on at any speed. The control algorithm turns the motor on at a speed that is proportional to the error signal. This is called proportional control because the motor speed is proportional to the error signal.

The drawback of proportional control is that it can be prone to overshoot and steady state errors. Overshoot is when the output of the system overshoots the desired output. Steady state error is when the output of the system is not equal to the desired output, even when the input is constant.

## Integral Control

Integral control deals with steady state error. The control algorithm adds up the error signal over time, and then uses this value to determine how to change the input to the system. This is called integral control because the input is proportional to the integral of the error signal. The integral of the error signal is called the integral error. 

The drawbacks of integral control are that it can be prone to windup and overshoot. Windup is when the integral error gets too large, and then the control algorithm can't change the input to the system anymore. 

## Derivative Control

Derivative control deals with overshoot. The control algorithm uses the rate of change of the error signal to determine how to change the input to the system. This is called derivative control because the input is proportional to the derivative of the error signal. The derivative of the error signal is called the derivative error.

Derivative control is usually used in conjunction with proportional control. The control algorithm uses proportional control to reduce the error signal, and then uses derivative control to reduce the rate of change of the error signal. This is called proportional-derivative control.


## PID Control

PID control is a combination of proportional, integral, and derivative control. The control algorithm uses proportional control to reduce the error signal, integral control to reduce the steady state error, and derivative control to reduce the rate of change of the error signal. This is called PID control because the input is proportional to the error signal, proportional to the integral of the error signal, and proportional to the derivative of the error signal. 

### Cascade PID


## Stability


## Open AI Gym Primer

Open AI Gym is a toolkit for developing and comparing reinforcement learning algorithms. It supports teaching agents everything from walking to playing games like Pong or Pinball. The three main functions used to interact with a gym enironment are:

- `env.reset()`: Resets the environment and returns the initial state.
- `env.step(action)`: Executes the given action and returns the next state, reward, and whether the episode is done.
- `env.render()`: Renders the environment.


## Applied Example - CartPole PID Control (use acrobot instead??)

The CartPole environment is a simulation of a pole attached to a cart. The goal of the agent is to balance the pole on the cart. The agent receives a reward of 1 for every step that the pole is balanced on the cart. The agent receives a reward of 0 if the pole falls over. The agent receives a reward of -1 if the pole falls over and the cart moves more than 2.4 units away from the center of the track. 

Below is some Python code to implement PID control to solve the cartpole environment using the simple pid library:

```python
import gym
import numpy as np
import time

env = gym.make('Pendulum-v1', g=4)
obs = env.reset()
dt = 0.025
# PID control parameters
kp = 0.1
ki = 0
kd = 0.01
# PID control variables
integral_error = 0
previous_error = 0
setpoint = 0

for t in range(10000):
    env.render()
    angle = np.rad2deg(np.arccos(obs[0]))
    if obs[1] < 0:
        angle = -angle
    error = setpoint - angle
    integral_error += error
    derivative_error = (error - previous_error)/dt
    previous_error = error
    action = (error * kp + integral_error * ki + derivative_error * kd)
    action = np.clip(action, -2, 2)
    obs, reward, done, info = env.step([action])
    time.sleep(dt)
    print('angle: ', np.round(angle), 'action: ', np.round(action, 2), 'error: ', np.round(error,2))

    if done:
        obs = env.reset()
```

[LINK](https://ethanr2000.medium.com/using-pid-to-cheat-an-openai-challenge-f17745226449)


<div style="padding: 15px; border: 1px solid transparent; border-color: transparent; margin-bottom: 20px; border-radius: 4px; color: #8a6d3b;; background-color: #fcf8e3; border-color: #faebcc;">
Disclaimer: Some of this module was written using AI suggestions by GitHub Copilot.   
</div>